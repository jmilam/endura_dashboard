<script type="text/javascript">
	
	$(document).ready(function(){
		$('#tsm_name').focus();
		
		function editTSM(){
			$('.edit_tsm').on('click', function(e){
				e.preventDefault();
				text = $(this).parents('tr').children('td:eq(0)').text();
				row = $(this).parents('tr');
				row.children('td:eq(0)').empty();
				row.children('td:eq(0)').append("<input class=form-control value='" + text + "'></input>");
				row.children('td:eq(1)').children('div').empty();
				row.children('td:eq(1)').children('div').append("<input type=submit value='Edit TSM' class='btn btn-sm btn-warning tsmEditBtn'>");
				submitTSMChanges();
			});
		}

		function submitTSMChanges(){
			$('.tsmEditBtn').on('click', function(e){
				e.preventDefault();
				text = $(this).parents('tr').children('td:eq(0)').children().val();
				row = $(this).parents('tr');
				val_id = row.children('td:eq(2)').children('#tsm_id').val();

				$.ajax({
          url: '/configurations/tsm_settings/' + val_id,
          type: 'put',
          datatype: 'json',
          data: {name: text},
          success: function (data) {
          	console.log(data);
              if (data["success"] == true){
              	row.children('td:eq(0)').empty();
								row.children('td:eq(0)').append(text);
								row.children('td:eq(1)').children('div').empty();
								row.children('td:eq(1)').children('div').append('<%= link_to "Edit", "#", class: "edit_tsm" %> | <%= link_to "Delete", "/configurations/tsm_settings/", data: {confirm: 'Are you sure you want to delete this tsm?'}, method: :delete %>' );
								row.children('td:eq(1)').children('div').children('a:last').attr('href', (row.children('td:eq(1)').children('div').children('a:last').attr('href') + val_id));
								editTSM();
              } else {
                alert("There was an error when making changes. Please try again");
              }
          }   
      	});
			});
		}

		$('.form_link').on('click', function(e){
			e.preventDefault();
			starting_row = $('#tsmTable tbody tr').length - 1
			$('#tsmTable tbody tr:eq(' + starting_row + ')').before('<tr><td><input type="text" name="tsmname" placeholder="Enter TSM Name" class="form-control"></td><td><input type="submit" value="Submit", class="btn btn-sm btn-success pull-right"></td>')
			
		});

		editTSM();
			
	});
</script>

<div class="container">

	<table class="table table" id="tsmTable">
		<thead>
			<tr>
				<th colspan=3><%= link_to "<< Back", configurations_management_overview_index_path %></th>
			</tr>
			<tr>
				<th class="text-center active" colspan=3><%= @header %></th>
			</tr>
		</thead>
		<tbody>
			<% @tsms.each do |tsm| %>
				<tr>
					<td><%= tsm.name %></td>
					<td><div class="pull-right"><%= link_to "Edit", "#", class: "edit_tsm" %> | <%= link_to "Delete", configurations_tsm_setting_path(id: tsm.id), data: {confirm: 'Are you sure you want to delete this tsm?'}, method: :delete %></div></td>
					<td><%= hidden_field_tag :tsm_id, tsm.id %></td>
				</tr>
			<% end %>
			<tr>
				<%= form_for :tsm, method: :create do |f| %>

					<td><%= f.text_field :name, class: "form-control", placeholder: "Enter TSM Name" %></td>
					<td><%= f.submit "Add TSM", class: "btn btn-sm btn-success pull-right" %></td>
					<td/>
				<% end %>
			</tr>
		</tbody>
	</table>
</div>